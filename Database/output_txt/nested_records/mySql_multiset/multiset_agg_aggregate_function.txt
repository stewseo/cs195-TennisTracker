nested_records/mySql_multiset/multiset_agg_aggregate_function
MultiSet Query and Result<?, ?>



Query Parts:
select
  "Film"."TITLE",
  multiset(
    select "ACTOR"."FIRST_NAME", "ACTOR"."LAST_NAME"
    from "FILM_ACTOR"
      join "ACTOR"
        on "ACTOR"."ACTOR_ID" = "FILM_ACTOR"."ACTOR_ID"
    where "FILM_ACTOR"."FILM_ID" = "Film"."FILM_ID"
  ) "actors",
  multiset(
    select "category"."name"
    from "film_category"
      join "category"
        on "category"."category_id" = "film_category"."category_id"
    where "film_category"."film_id" = "Film"."FILM_ID"
  ) "categories",
  multiset(
    select
      "Customer"."first_name",
      "Customer"."last_name",
      multiset_agg("payment"."payment_date") "payments",
      sum("payment"."amount") "total"
    from "payment"
      join "Customer"
        on "payment"."customer_id" = "Customer"."customer_id"
      join "rental"
        on "payment"."rental_id" = "rental"."rental_id"
      join "inventory"
        on "rental"."inventory_id" = "inventory"."inventory_id"
    where "inventory"."film_id" = "Film"."FILM_ID"
    group by "Customer"."customer_id", "Customer"."first_name", "Customer"."last_name"
  ) "customers"
from "Film"
where "Film"."TITLE" like 'A%'
order by "Film"."TITLE"
limit 53
Sql Stringset @t = @@group_concat_max_len; set @@group_concat_max_len = 4294967295; select `Film`.`TITLE`, (select coalesce(json_merge_preserve('[]', concat('[', group_concat(json_array(`v0`, `v1`) separator ','), ']')), json_array()) from (select `ACTOR`.`FIRST_NAME` as `v0`, `ACTOR`.`LAST_NAME` as `v1` from `FILM_ACTOR` join `ACTOR` on `ACTOR`.`ACTOR_ID` = `FILM_ACTOR`.`ACTOR_ID` where `FILM_ACTOR`.`FILM_ID` = `Film`.`FILM_ID`) as `t`) as `actors`, (select coalesce(json_merge_preserve('[]', concat('[', group_concat(json_array(`v0`) separator ','), ']')), json_array()) from (select `category`.`name` as `v0` from `film_category` join `category` on `category`.`category_id` = `film_category`.`category_id` where `film_category`.`film_id` = `Film`.`FILM_ID`) as `t`) as `categories`, (select coalesce(json_merge_preserve('[]', concat('[', group_concat(json_array(`v0`, `v1`, json_extract(`v2`, '$'), `v3`) separator ','), ']')), json_array()) from (select `Customer`.`first_name` as `v0`, `Customer`.`last_name` as `v1`, json_merge_preserve('[]', concat('[', group_concat(json_array(`payment`.`payment_date`, `payment`.`amount`) separator ','), ']')) as `v2`, sum(`payment`.`amount`) as `v3` from `payment` join `Customer` on `payment`.`customer_id` = `Customer`.`customer_id` join `rental` on `payment`.`rental_id` = `rental`.`rental_id` join `inventory` on `rental`.`inventory_id` = `inventory`.`inventory_id` where `inventory`.`film_id` = `Film`.`FILM_ID` group by `Customer`.`customer_id`, `Customer`.`first_name`, `Customer`.`last_name`) as `t`) as `customers` from `Film` where `Film`.`TITLE` like ? order by `Film`.`TITLE` limit ?; set @@group_concat_max_len = @t;
The formatted plan as returned by the database:
 +----+------------------+-------------+----------+------+------------------------------------+-------------------+-------+--------------------------------+----+--------+--------------------------------------------+
|  id|select_type       |table        |partitions|type  |possible_keys                       |key                |key_len|ref                             |rows|filtered|Extra                                       |
+----+------------------+-------------+----------+------+------------------------------------+-------------------+-------+--------------------------------+----+--------+--------------------------------------------+
|   1|PRIMARY           |Film         |{null}    |range |idx_title                           |idx_title          |767    |{null}                          |  46|   100.0|Using where; Using index                    |
|   6|DEPENDENT SUBQUERY|<derived7>   |{null}    |ALL   |{null}                              |{null}             |{null} |{null}                          |  14|   100.0|{null}                                      |
|   7|DEPENDENT DERIVED |inventory    |{null}    |ref   |PRIMARY,idx_fk_film_id              |idx_fk_film_id     |4      |sakila.Film.film_id             |   4|   100.0|Using index; Using temporary; Using filesort|
|   7|DEPENDENT DERIVED |rental       |{null}    |ref   |PRIMARY,idx_fk_inventory_id         |idx_fk_inventory_id|4      |sakila.inventory.inventory_id   |   3|   100.0|Using index                                 |
|   7|DEPENDENT DERIVED |payment      |{null}    |ref   |idx_fk_customer_id,fk_payment_rental|fk_payment_rental  |5      |sakila.rental.rental_id         |   1|   100.0|{null}                                      |
|   7|DEPENDENT DERIVED |Customer     |{null}    |eq_ref|PRIMARY                             |PRIMARY            |4      |sakila.payment.customer_id      |   1|   100.0|{null}                                      |
|   4|DEPENDENT SUBQUERY|film_category|{null}    |ref   |PRIMARY,fk_film_category_category   |PRIMARY            |4      |sakila.Film.film_id             |   1|   100.0|Using index                                 |
|   4|DEPENDENT SUBQUERY|category     |{null}    |eq_ref|PRIMARY                             |PRIMARY            |4      |sakila.film_category.category_id|   1|   100.0|{null}                                      |
|   2|DEPENDENT SUBQUERY|FILM_ACTOR   |{null}    |ref   |PRIMARY,idx_fk_film_id              |idx_fk_film_id     |4      |sakila.Film.film_id             |   5|   100.0|Using index                                 |
|   2|DEPENDENT SUBQUERY|ACTOR        |{null}    |eq_ref|PRIMARY                             |PRIMARY            |4      |sakila.FILM_ACTOR.actor_id      |   1|   100.0|{null}                                      |
+----+------------------+-------------+----------+------+------------------------------------+-------------------+-------+--------------------------------+----+--------+--------------------------------------------+

The cost the database associated with the execution of the query:  NaN
The estimated number of rows (cardinality) that is to be returned by the query: 46.0
The actual number of rows (cardinality) returned by the query:  46

Result Records:
  +---------------------------+--------------------------------------------------+---------------+--------------------------------------------------+
|TITLE                      |actors                                            |categories     |customers                                         |
+---------------------------+--------------------------------------------------+---------------+--------------------------------------------------+
|ACADEMY DINOSAUR           |[(PENELOPE, GUINESS), (CHRISTIAN, GABLE), (LUCI...|[(Documentary)]|[(SUSAN, WILSON, [(2005-07-31T22:08:29, 0.99)],...|
|ACE GOLDFINGER             |[(BOB, FAWCETT), (MINNIE, ZELLWEGER), (SEAN, GU...|[(Horror)]     |[(KATHRYN, COLEMAN, [(2005-07-28T05:04:47, 9.99...|
|ADAPTATION HOLES           |[(NICK, WAHLBERG), (BOB, FAWCETT), (CAMERON, ST...|[(Documentary)]|[(MARY, SMITH, [(2005-08-01T08:51:04, 4.99)], 4...|
|AFFAIR PREJUDICE           |[(JODIE, DEGENERES), (SCARLETT, DAMON), (KENNET...|[(Horror)]     |[(KIMBERLY, LEE, [(2005-06-16T14:39:31, 2.99)],...|
|AFRICAN EGG                |[(GARY, PHOENIX), (DUSTIN, TAUTOU), (MATTHEW, L...|[(Family)]     |[(AMY, LOPEZ, [(2005-07-28T07:26:14, 2.99)], 2....|
|AGENT TRUMAN               |[(KIRSTEN, PALTROW), (SANDRA, KILMER), (JAYNE, ...|[(Foreign)]    |[(ELIZABETH, BROWN, [(2005-07-29T01:11:23, 2.99...|
|AIRPLANE SIERRA            |[(JIM, MOSTEL), (RICHARD, PENN), (OPRAH, KILMER...|[(Comedy)]     |[(TERESA, ROGERS, [(2005-08-21T04:34:11, 4.99)]...|
|AIRPORT POLLOCK            |[(FAY, KILMER), (GENE, WILLIS), (SUSAN, DAVIS),...|[(Horror)]     |[(EVELYN, MORGAN, [(2005-06-18T13:11:13, 4.99)]...|
|ALABAMA DEVIL              |[(CHRISTIAN, GABLE), (ELVIS, MARX), (RIP, CRAWF...|[(Horror)]     |[(TAMMY, SANDERS, [(2005-07-30T21:44:31, 4.99)]...|
|ALADDIN CALENDAR           |[(ALEC, WAYNE), (JUDY, DEAN), (VAL, BOLGER), (R...|[(Sports)]     |[(DOROTHY, TAYLOR, [(2005-07-07T03:06:40, 4.99)...|
|ALAMO VIDEOTAPE            |[(JOHNNY, CAGE), (SCARLETT, DAMON), (SEAN, GUIN...|[(Foreign)]    |[(BARBARA, JONES, [(2005-08-02T07:09:34, 0.99)]...|
|ALASKA PHANTOM             |[(VAL, BOLGER), (BURT, POSEY), (SIDNEY, CROWE),...|[(Music)]      |[(ELIZABETH, BROWN, [(2005-08-22T17:37:02, 0.99...|
|ALI FOREVER                |[(CARY, MCCONAUGHEY), (CHRISTOPHER, BERRY), (KE...|[(Horror)]     |[(DOROTHY, TAYLOR, [(2005-08-22T21:59:29, 5.99)...|
|ALICE FANTASIA             |[(WOODY, HOFFMAN), (MINNIE, ZELLWEGER), (MORGAN...|[(Classics)]   |[]                                                |
|ALIEN CENTER               |[(BURT, DUKAKIS), (KENNETH, PALTROW), (SIDNEY, ...|[(Foreign)]    |[(MARIA, MILLER, [(2005-08-18T21:55:01, 2.99)],...|
|ALLEY EVOLUTION            |[(KARL, BERRY), (JUDE, CRUISE), (ALBERT, JOHANS...|[(Foreign)]    |[(DOROTHY, TAYLOR, [(2005-07-28T05:21:42, 2.99)...|
|ALONE TRIP                 |[(ED, CHASE), (KARL, BERRY), (UMA, WOOD), (WOOD...|[(Music)]      |[(MELISSA, KING, [(2005-08-21T17:18:33, 2.99)],...|
|ALTER VICTORY              |[(REESE, KILMER), (JADA, RYDER), (ANGELA, WITHE...|[(Animation)]  |[(ELIZABETH, BROWN, [(2005-07-28T01:50:29, 0.99...|
|AMADEUS HOLY               |[(JOHNNY, LOLLOBRIGIDA), (JULIA, MCQUEEN), (VAL...|[(Action)]     |[(BARBARA, JONES, [(2005-06-16T15:51:52, 0.99)]...|
|AMELIE HELLFIGHTERS        |[(CARMEN, HUNT), (WALTER, TORN), (ED, MANSFIELD...|[(Music)]      |[(RUBY, WASHINGTON, [(2005-07-28T13:01:22, 6.99...|
|AMERICAN CIRCUS            |[(KEVIN, BLOOM), (RIP, CRAWFORD), (SIDNEY, CROW...|[(Action)]     |[(AMANDA, CARTER, [(2005-07-30T06:59:55, 8.99)]...|
|AMISTAD MIDSUMMER          |[(CARY, MCCONAUGHEY), (DARYL, WAHLBERG), (SALMA...|[(New)]        |[(MARY, SMITH, [(2005-07-29T03:58:49, 2.99)], 2...|
|ANACONDA CONFESSIONS       |[(PENELOPE, GUINESS), (JENNIFER, DAVIS), (ELVIS...|[(Animation)]  |[(LINDA, WILLIAMS, [(2005-06-16T15:19:10, 6.99)...|
|ANALYZE HOOSIERS           |[(TOM, MCKELLEN), (TOM, MIRANDA), (JESSICA, BAI...|[(Horror)]     |[(BETTY, WHITE, [(2005-07-30T21:36:15, 4.99)], ...|
|ANGELS LIFE                |[(PENELOPE, GUINESS), (JENNIFER, DAVIS), (GRACE...|[(New)]        |[(HEATHER, MORRIS, [(2005-08-21T01:15:59, 5.99)...|
|ANNIE IDENTITY             |[(ADAM, GRANT), (CATE, MCQUEEN), (GRETA, KEITEL)] |[(Sci-Fi)]     |[(BARBARA, JONES, [(2005-08-19T02:19:13, 1.99)]...|
|ANONYMOUS HUMAN            |[(GRACE, MOSTEL), (FAY, KILMER), (JIM, MOSTEL),...|[(Sports)]     |[(PATRICIA, JOHNSON, [(2005-08-01T09:45:26, 0.9...|
|ANTHEM LUKE                |[(MILLA, KEITEL), (OPRAH, KILMER)]                |[(Comedy)]     |[(DEBBIE, REYES, [(2005-08-22T08:42:45, 4.99)],...|
|ANTITRUST TOMATOES         |[(BETTE, NICHOLSON), (UMA, WOOD), (SIDNEY, CROW...|[(Action)]     |[(JANICE, WARD, [(2005-08-21T01:31:25, 2.99)], ...|
|ANYTHING SAVANNAH          |[(JOE, SWANK), (CHRISTOPHER, WEST), (LISA, MONR...|[(Horror)]     |[(JANE, BENNETT, [(2005-06-16T14:11:24, 4.99)],...|
|APACHE DIVINE              |[(NICK, WAHLBERG), (CUBA, OLIVIER), (ANNE, CRON...|[(Family)]     |[(RUTH, MARTINEZ, [(2005-07-30T11:06:23, 5.99)]...|
|APOCALYPSE FLAMINGOS       |[(MAE, HOFFMAN), (VIVIEN, BASINGER), (OPRAH, KI...|[(New)]        |[(SALLY, PIERCE, [(2005-08-23T03:50:48, 4.99)],...|
|APOLLO TEEN                |[(MAE, HOFFMAN), (WOODY, JOLIE), (ED, MANSFIELD...|[(Drama)]      |[]                                                |
|ARABIA DOGMA               |[(KARL, BERRY), (RIP, CRAWFORD), (JULIA, MCQUEE...|[(Horror)]     |[(VIRGINIA, GREEN, [(2005-06-16T04:09:08, 0.99)...|
|ARACHNOPHOBIA ROLLERCOASTER|[(GRACE, MOSTEL), (JUDY, DEAN), (DARYL, WAHLBER...|[(Horror)]     |[(BARBARA, JONES, [(2005-07-29T18:44:57, 3.99)]...|
|ARGONAUTS TOWN             |[(JULIA, BARRYMORE), (GARY, PENN), (GENE, WILLI...|[(Animation)]  |[]                                                |
|ARIZONA BANG               |[(KARL, BERRY), (RAY, JOHANSSON), (RUSSELL, BAC...|[(Classics)]   |[(ELIZABETH, BROWN, [(2005-08-21T14:02:50, 2.99...|
|ARK RIDGEMONT              |[(PARKER, GOLDBERG), (NICK, DEGENERES), (AUDREY...|[(Action)]     |[]                                                |
|ARMAGEDDON LOST            |[(ANGELA, HUDSON), (JAMES, PITT), (PENELOPE, CR...|[(Sci-Fi)]     |[(PAMELA, BAKER, [(2005-08-23T17:32:19, 0.99)],...|
|ARMY FLINTSTONES           |[(ED, CHASE), (CARY, MCCONAUGHEY), (MAE, HOFFMA...|[(Documentary)]|[(NANCY, THOMAS, [(2005-08-20T02:37:07, 0.99)],...|
|ARSENIC INDEPENDENCE       |[(CUBA, ALLEN), (RITA, REYNOLDS), (OPRAH, KILMER)]|[(Travel)]     |[]                                                |
|ARTIST COLDBLOODED         |[(ED, CHASE), (SANDRA, KILMER), (KIRK, JOVOVICH...|[(Sports)]     |[(BARBARA, JONES, [(2005-06-16T14:01:27, 2.99)]...|
|ATLANTIS CAUSE             |[(WOODY, HOFFMAN), (AUDREY, OLIVIER), (JULIANNE...|[(Family)]     |[(EDNA, WEST, [(2005-07-31T13:25:46, 2.99)], 2....|
|ATTACKS HATE               |[(DAN, TORN), (MILLA, KEITEL), (GROUCHO, DUNST)...|[(Sci-Fi)]     |[(MARY, SMITH, [(2005-06-18T08:41:48, 4.99)], 4...|
|ATTRACTION NEWTON          |[(UMA, WOOD), (RIP, WINSLET), (GARY, PENN), (CH...|[(New)]        |[(SANDRA, MARTIN, [(2005-08-20T01:10:27, 6.99)]...|
|AUTUMN CROW                |[(DUSTIN, TAUTOU), (ANGELA, HUDSON), (JAMES, PI...|[(Games)]      |[(ALICE, STEWART, [(2005-07-06T01:02:39, 9.99)]...|
+---------------------------+--------------------------------------------------+---------------+--------------------------------------------------+
